# 系统架构设计

## 1. 引言

### 1.1 编写目的

编写本文档主要用于说明互联网广告系统的具体系统架构设计。其中，具体说明了系统架构设计的目标，规定了系统的开发环境和运行环境，阐述了逻辑架构设计的整体思想和具体设计的实现，介绍了系统的主要业务流程和系统的功能模块的划分以及模块之间的联系，表明了系统采用存储的数据库类型以及数据库又采用了什么设计编辑工具和数据库中存储的各种表的具体信息，最后是设计了系统核心功能的界面原型。

### 1.2 读者对象

系统管理者：在系统正式运行后，系统的管理者，主要用来维护系统的正常运行，保证系统数据库信息的安全，能够及时应对系统在运行时出现的一些小问题。

系统开发人员：整个系统的主要开发人员，也是系统架构和功能的主要设计人员，负责系统的web前端和后端的开发。

系统测试人员：在系统完成了初步实现后，对系统进行各方面的测试，其中包括系统的功能是否全面，系统的响应和事件的处理是否快捷，系统的安全性以及系统整体的业务流程等方面。

## 2. 系统概述

互联网广告系统服务提供企业（例如，搜索服务提供商，翻译服务提供商）通过展示企业客户广告获得服务收益，企业客户向互联网服务提供商购买广告，购买的广告展示在服务使用界面上（Web应用、移动APP、微信小程序等）展示。

互联网广告系统主要满足的功能需求如下：

- 企业广告审核
  1. 管理员可以在页面中看到待审核的广告列表
  2. 管理员可以打开广告查看广告内容
  3. 管理员可以选择审核通过或审核不通过，若审核不通过可以上传不通过理由
- 企业客户信息审核
  1. 管理员可以在页面中查看待审核企业客户信息列表
  2. 管理员可以打开用户信息查看详细内容
  3. 管理员可以选择审核通过或审核不通过，若审核不通过可以上传不通过理由

- 管理平台-浏览/查询广告

  1. 支持分页浏览、查询
  2. 根据输入的广告标题、价格、创作时间等查询
  3. 广告标题支持模糊匹配，创作时间进行范围查询
  4. 价格查询结果可以进行排序

- 客户平台-个人详情页

  1. 客户点击按钮进入个人详情页
  2. 用户点击“用户名”对话框输入想要更改的用户名
  3. 系统检测该用户名重复则显示类似“该用户名重复”的提示，并要求用户重新输入用户名
  4. 用户点击“公司”对话框输入公司名称
  5. 用户通过“余额”对话框可以观察到账号剩余金额
  6. 用户点击“余额”对话框后可点击“充值”按钮，输入充值金额进行充值
  7. 用户点击“正在投放“按钮，即可看到自己正在投放广告的信息（剩余时长等）
  8. 用户点击"历史记录"按钮，即可看到自己以往投放的广告信息、需求
  9. 用户点击确认按钮退出浏览或完成并保存修改
  10. 用户点击取消按钮退出浏览并不保存修改

## 3. 架构设计目标和约束

### 3.1 架构设计目标

架构设计的主要目的是为了解决软件系统复杂度带来的问题。

架构设计是宏观性考量，在整体上理解问题的复杂性，给出方案，并论证方案的可行性，提供一系列准则指导执行。

因此，架构设计的目标主要有以下几点：

（1）提前识别问题的复杂性和关注点，提供可行的经过论证的解决方案；

（2）建立服务质量指标，确定设计方案可以满足指定的质量指标；

（3）规划整体设计，提供长远的可扩展性；

（4）为实际开发确定基本框架。

### 3.2 约束需求

#### 3.2.1软件、硬件环境（包括运行环境和开发环境）的约束

软件开发和运行是基于64位Windows操作系统，所以软件可在64位Windows操作系统上的网页浏览器中正常打开和运行。采用xx完成Web前端的开发，java17完成后端开发，MySQL 8.0进行数据库的设计和编辑，最终在Windows 10操作系统上浏览器完成系统的测试和最终运行。

#### 3.2.2接口/协议的约束

在内部接口方面，各模块之间采用函数调用、参数传递、返回值等方式进行信息传递。接口传递的信息将是以数据结构封装的数据，以参数传递或返回值的形式在各模块间传输。

#### 3.2.3用户界面的约束

UI的设计开发基于html5、css3和JavaScript等前端开发语言。在UI的设计中要具备适用性，易于用户理解；当错误操作时会有提示信息和防错处理，整体的布局和色彩的适用要合理，在事件的响应方面要最高效率，整体界面可复用，控件设置满足单一应对原则。网络通信协议采用 HTTP和TCP/IP协议，调用接口采用 Web Service，系统通过内嵌浏览器技术与扩展对象插件接口集成。

#### 3.2.4软件质量的约束

（1）正确性:
UI上的控件能够正确且及时响应，实现该控件对应功能，错误操作会进行信息提示，同时添加防错处理，及时应对出现的错误操作。

（2）可靠性:
设置备用服务器保证系统正常工作。当遇到断电重启的情况，能够实现系统断电后的自动重启，且较少人工维护量和实现系统稳定运行。

（3）效率:
数据信息的采集通讯支持10秒以上的实时数据传输（受网络环境影响），并且要求系统的响应时间不超过5秒。

（4）安全性:
用户注册/登录系统，关键数据操作，需要验证码进行验证，关于数据采用加密技术。

（5）可扩展性:
系统在整体设计上要充分考虑可扩展性，当用户的需求变化时，系统可进行相应的处理；当系统在运行中，客户如果对原有功能作调整或变更，系统应该能够灵活地修改。同时，预留接口，能扩展到其他监测系统。

## 4. 系统总体设计

### 4.1 设计思想

三层架构(3-tier architecture) 通常意义上的三层架构就是将整个业务应用划分为：界面层（User Interface layer）、业务逻辑层（Business Logic Layer）、数据访问层（Data access layer）。区分层次的目的即为了“高内聚低耦合”的思想。3个层次中，系统主要功能和业务逻辑都在业务逻辑层进行处理。

![图4.1 三层架构图](https://img2020.cnblogs.com/blog/1975727/202006/1975727-20200623202256467-758567728.png)

### 4.2 系统主要业务流程设计

![图4.2 时序图](https:////www.plantuml.com/plantuml/png/XTBDQiGW4C3nkq_XiJtq1Nee2O52RuK-WTNPx82ECeu9-_ORTm-B8H_d-Gtp5-oo69OIl5Az2qZwuqiF7e54Vsg62M7ktGGic240oTkxUeuhx5FoQ8rWf8SUCGlm0V5nH5hcUwU6aYK6u1-wn4tspt7Eq3AzwrRb6ow3DEYNqIADcpOn97Dh-3V0mMjJONirgum_u0bjNNlXy_RcI2qxTsrCISx8gaICbBoig0x8rIzm1m00)

### 4.3 功能模块划分

功能模块划分如下图所示：

![图4.3 类图](https://www.plantuml.com/plantuml/png/bLLTYXin37wVK_WneSq5GbasRIa4IYbiBw2rtOdfZ2qiESjIUlT66QUHErcOF2N-zADFdsJF8p5aBkFGsG68pCwD8PhVdJ4RaBzxjpKXifmB-HnXz5lpn3d4NZ04efUKdSBU3QaFSRNUccCAhWAfi4O0CQUZtxcZpnp8Zpxo2avP6cGUy6a8ucdFFriZnyRjEQSNgbxx-3Fb4JYaCvclWVZ3P7cukhOCBcuAhTxakG6_vs13xEUStniycKuQkLIU1w-uZH2Xzpl48TWpA_gdo9-kgZ_nc-IVchnV_nhuxJzFcoA3rQfeArYRIkIFC42yiXVQsVU1sESBsOKJBkY0lQgcZSvZei1VIdIqWb4gtn3C7hpzrQhki-GJYZeTbcmFG7Ui4nL27zsY03MUndgv96f2u5hL1VdnYWr235n88pZjaX9zqowuCEvb0VTEsWuAaNg2rMmLbg9p-EbSUGPVLdcj20XUxzfQiw2h-tpDzU1hhRRPcPxgCbGr4RMSYAsUMZtTB-9CcIbqWGPtCjORy3aG3l1wghM8lSW7sHuMlZcLbyOh_LklpfkyfmTzitbe8nGkuzM07ait6M_5wrERvxP4ynJTeuzEFZrTznS0)

#### 4.3.1. 模块描述

- UI模块:
该模块用户可见，是系统和用户之间进行交互和信息交换的媒介，它实现信息的内部形式与人类可以接受形式之间的转换。

- 系统管理模块:
该模块是整个系统核心，它的关注点主要集中在业务规则的制定、业务流程的实现等与业务需求有关的系统设计

- 数据库模块:
数据库是“按照数据结构来组织、存储和管理数据的仓库”用来收集用户所填信息，注册信息及一切有关数据，对系统提供数据支持

#### 4.3.2. 模块接口设计

接口的变化，对于外部的表现来看，无非是输入和输出的变化，在实际的软件工程中，由于需求的变更，软件功能和规格的变化，接口的变化也在所难免，如何将修改的影响降低，在设计中还是有些方法来使用。

应对输入变化的场景：

（1）尽量不要用参数的个数来变化；

（2）C语言中接口使用数据结构的变化来保证接口的兼容性；

（3）使用无值型的指针，通过强制转换来适应不同的结构体，同样保证了接口的兼容性，接口参数使用字符串，通过规范字符串的格式来进行不同参数的修改和传递，保证接口不变化，有点类似数据结构的方式，URL字串使用就是典型的方式。

应对输出变化的场景：

（1）返回数据的定义需要进行规范，常用的方式是返回错误码；

（2）返回数据指针；

（3）返回数据结构/类。

## 5. 数据库设计概述

### 5.1 数据库环境说明

MySQL是一种关系型数据库管理系统，关系型数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。这次采用的是开发设计工具是MySQL 8.0版本。

### 5.3 表汇总说明

- 广告表（Ad Table）：用于存储广告的信息，包括广告ID、广告主ID、广告内容、广告状态、投放时段、地域等。广告表可以记录广告的基本信息，并与其他表进行关联。

- 广告展示记录表（Ad Impression Table）：用于存储广告展示的记录，包括展示时间、展示位置、展示终端等信息。广告展示记录表可以用于统计广告的展示次数，并生成报告。

- 广告点击记录表（Ad Click Table）：用于存储广告点击的记录，包括点击时间、点击位置、点击用户等信息。广告点击记录表可以用于统计广告的点击次数，并生成报告。

- 用户表（User Table）：用于存储用户的信息，包括用户ID、用户名、密码、权限等。用户表可以用于实现用户认证和授权功能。

- 企业客户表（Company Customer Table）：用于存储企业客户的信息，包括企业客户ID、企业名称、联系信息等。企业客户表可以用于管理企业客户的信息，并与广告表进行关联。

- 财务记录表（Finance Record Table）：用于存储企业客户的财务记录，包括充值记录、支付记录、消费记录等。财务记录表可以用于查询企业客户的账户余额和消费明细。

- 广告审核记录表（Ad Audit Record Table）：用于存储广告审核的记录，包括审核时间、审核结果、审核人等信息。广告审核记录表可以用于记录广告的审核历史。

## 6. 用户界面设计
